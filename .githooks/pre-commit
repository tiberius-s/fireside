#!/usr/bin/env bash
# pre-commit â€” runs before every commit.
# Mirrors the "Format check" step in .github/workflows/rust.yml.
#
# Install once: git config core.hooksPath .githooks
#   or run:     .githooks/install.sh

set -euo pipefail

echo "ğŸ” pre-commit: checking formatting..."

if ! cargo fmt --check --quiet 2>&1; then
  echo ""
  echo "âŒ Formatting issues found. Run 'cargo fmt' to fix them, then re-stage."
  exit 1
fi

echo "âœ… Formatting OK."

echo "ğŸ” pre-commit: running clippy..."

if ! cargo clippy --workspace --quiet -- -D warnings 2>&1; then
  echo ""
  echo "âŒ Clippy errors. Fix them before committing."
  exit 1
fi

echo "âœ… Clippy OK."

echo "ğŸ” pre-commit: running docs check..."

if ! RUSTDOCFLAGS=-D warnings cargo doc --workspace --no-deps --quiet 2>&1; then
  echo ""
  echo "âŒ Documentation warnings/errors; fix them before committing."
  exit 1
fi

echo "âœ… Docs OK."
